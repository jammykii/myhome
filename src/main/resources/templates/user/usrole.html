<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: head('권한설정')">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link href="/starter-template.css" th:href="@{/starter-template.css}" rel="stylesheet">
    <title>게시판</title>
</head>

<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top" th:replace="fragments/common :: menu('role')">
</nav>
<div class="container">
<table class="table table-striped" >
    <thead>
      <tr>
        <th scope="col">아이디</th>
        <th scope="col">이름</th>
        <th scope="col">권한아이디</th>
        <th scope="col">권한</th>
        <th scope="col">설정</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="user : ${users}">
        <td th:text="${user.id}">1</td>
        <td th:text="${user.username}">Mark</td>
        <td th:text="${user.roles[0].id}">Otto</td>
        <td th:text="${user.roles[0].name}">@mdo</td>
        <td><a type="button" class="btn btn-primary" th:href="@{/user/modify(id=${user.id})}">수정</a></td>
      </tr>
    </tbody>
  </table>
<table class="table table-striped">
    <thead>
      <tr>
        <th scope="col">아이디</th>
        <th scope="col">이름</th>
        <th scope="col">권한아이디</th>
        <th scope="col">권한</th>
        <th scope="col">삭제</th>
      </tr>
    </thead>
    <tbody>
      <tr th:each="user : ${users}" th:if="${user.roles.size()} >= 2">
        <td th:text="${user.id}">1</td>
        <td th:text="${user.username}">Mark</td>
        <td th:text="${user.roles[1].id}">Otto</td>
        <td th:text="${user.roles[1].name}">@mdo</td>
        <td><button type="button" sec:authorize="hasAuthority('TOTAL_ADMIN')" class="btn btn-primary" 
          th:onclick="|deleteUserRole(${user.id},${user.roles[1].id})|" >권한삭제</button></td>
      </tr>
    </tbody>
  </table>
</div>
    <footer th:replace="fragments/common :: footer"></footer>
    <script>
      function deleteUserRole(userId, roleId) {
        console.log(userId, roleId)
          //DELETE /api/boards/{id}
          $.ajax({
              url: '/api/userRole?userid=' + userId +'&roleid=' +roleId,
              type: 'DELETE',
              success: function(result) {
                  console.log('result', result);
                  alert('삭제됐습니다.');     
                  window.location.href = '/user/usrole';
              }
          });
      }
  </script>
</body>

</html>